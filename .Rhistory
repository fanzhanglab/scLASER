knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>",
warning = FALSE,
message = FALSE,
fig.width = 7,
fig.height = 4.5
)
library(scLASER)
library(dplyr)
d2 <- generate_dummy_data(
n_cells = 800,
sd_celltypes = 0.15,
n_major_cell_types = 5,
n_minor_cell_types = 2,
relative_abundance = 0.25,
n_major_interact_celltypes = 2,
n_minor_interact_celltypes = 1,
n_individuals = 20,
n_batchs = 3,
interaction_feature = "visit",
time_points = 2,
test_var = "disease",
prop_disease = 0.5,
fc_interact = 0.20,
interaction_type = "specific",
seed = 2025,
# explicit visit effects for 2TP
visit_effects_progressor = c(0.2, -0.2),
visit_effects_control    = c(0.0, 0.0),
# direction for interacting clusters
direction_by_cluster = c(+1, -1, +1)
)
dplyr::glimpse(d2)
pcs2 <-  generate_pseudo_pcs_time(
d2,
n_pcs = 20,
cluster_pcs = 1:20,
disease_pcs = 0,
sex_pcs = 0,
age_pcs = 0,
bmi_pcs = 0,
batch_pcs = 0,
interaction_pcs = 0,
visit_pcs = 0,
subject_pcs = 0,
cluster_ratio = 0.8,
disease_ratio = 0,
sex_ratio = 0,
age_ratio = 0,
bmi_ratio = 0,
batch_ratio = 0,
interaction_ratio = 0,
visit_ratio = 0,
subject_ratio = 0,
scale_factor = 5,
cluster_col = "cell_type",
sex_col = "sex",
age_col = "age",
bmi_col = "bmi",
batch_col = "batch",
disease_col = "disease",
visit_col = "visit",
seed = 1234
)
dim(pcs2)
obj2 <- scLASER(metadata = d2, pcs = pcs2)
# Proportion plots (auto-handles V0, V1)
plot_celltype_proportions(obj2)
obj2 <- compute_umap(obj2, n_neighbors = 30, metric = "cosine", min_dist = 0.01)
obj2 <- run_harmony(
obj2,
batch_col = "sample_id",
theta = 2,
epsilon.cluster = -Inf,
epsilon.harmony = -Inf,
max.iter.cluster = 30,
max.iter.harmony = 10,
plot_convergence = FALSE
)
obj2 <- association_nam_scLASER(
object = obj2,
test_var = "test_var_cna",
samplem_key = "subject_id",
graph_use = "RNA_nn",
batches = "batch",
covs = c("age", "sex"),
Nnull = 1000,
local_test = TRUE,
seed = 1234
)
# Output is a matrix
# Align names for longitudinal analysis
rownames(obj2@nam_pcs) <- obj2@metadata$sample_id
obj2 <- longAnalyses_plusModelSelection(
obj2,
disease_var = "disease",
subject_var = "subject_id",
sample_var  = "sample_id",
time_var    = "visit",
covariates  = c("age", "sex")
)
obj2@pipeline_output
obj2@pipeline_output %>% filter(lrt_pval < 0.05)
obj2@pipeline_output
longAnalyses_plusModelSelection
obj2@NAM_matrix
obj2@metadata
obj2@harmony
ls()
devtools::install_github("fanzhanglab/scLASER",auth_token = "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")
devtools::install_github("fanzhanglab/scLASER",auth_token = "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",force = T)
devtools::install_github("fanzhanglab/scLASER",auth_token = "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",force = T)
devtools::install_github("fanzhanglab/scLASER",auth_token = "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",force = T)
devtools::document()
devtools::install_github("fanzhanglab/scLASER",auth_token = "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",force = T)
library(scLASER)
library(dplyr)
d2 <- generate_dummy_data(
n_cells = 800,
sd_celltypes = 0.15,
n_major_cell_types = 5,
n_minor_cell_types = 2,
relative_abundance = 0.25,
n_major_interact_celltypes = 2,
n_minor_interact_celltypes = 1,
n_individuals = 20,
n_batchs = 3,
interaction_feature = "visit",
time_points = 2,
test_var = "disease",
prop_disease = 0.5,
fc_interact = 0.20,
interaction_type = "specific",
seed = 2025,
# explicit visit effects for 2TP
visit_effects_progressor = c(0.2, -0.2),
visit_effects_control    = c(0.0, 0.0),
# direction for interacting clusters
direction_by_cluster = c(+1, -1, +1)
)
dplyr::glimpse(d2)
