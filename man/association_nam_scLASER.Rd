% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/association_nam.R
\name{association_nam_scLASER}
\alias{association_nam_scLASER}
\title{Association testing between NAM embeddings and a sample-level variable}
\usage{
association_nam_scLASER(
  obj,
  seurat_object = NULL,
  test_var = NULL,
  samplem_key = NULL,
  graph_use = "RNA_snn",
  batches = NULL,
  covs = NULL,
  nsteps = NULL,
  verbose = TRUE,
  assay = NULL,
  key = "NAMPC_",
  maxnsteps = 15L,
  max_frac_pcs = 0.15,
  n_pcs = NULL,
  ks = NULL,
  Nnull = 1000,
  force_permute_all = FALSE,
  seed = 1234,
  return_nam = TRUE
)
}
\arguments{
\item{obj}{A \code{\linkS4class{scLASER}} object. If \code{seurat_object} is
\code{NULL}, \code{obj} must have both \code{@metadata} and \code{@harmony}
populated so a minimal Seurat object can be constructed.}

\item{seurat_object}{Optional. A \code{Seurat} object with a precomputed
cell-cell neighbor graph (e.g., after \code{Seurat::FindNeighbors()}).
If \code{NULL}, a minimal Seurat object is built from \code{obj}.}

\item{test_var}{Character scalar. Column name in sample-level metadata
(derived from \code{seurat_object@meta.data}) giving a numeric variable
to test for association with NAM embeddings.}

\item{samplem_key}{Character scalar. Column name identifying samples in the
cell-level metadata (and used to derive sample-level metadata).}

\item{graph_use}{Character scalar. Name of the graph in
\code{seurat_object@graphs} to use. Default is \code{"RNA_snn"}.}

\item{batches}{Optional character vector of column names (sample-level) used
to define permutation blocks for conditional permutations. If \code{NULL},
all samples are permuted together.}

\item{covs}{Optional character vector of sample-level covariate column names
to regress out (residualize) before association testing.}

\item{nsteps}{Integer or \code{NULL}. Number of diffusion steps used to build
NAM. If \code{NULL}, an adaptive stopping rule is used.}

\item{verbose}{Logical. Print progress messages.}

\item{assay}{Character or \code{NULL}. Assay name used when creating the
NAM reduction object internally.}

\item{key}{Character. Key prefix for NAM PC names in the created reduction.}

\item{maxnsteps}{Integer. Maximum diffusion steps when using adaptive
stopping.}

\item{max_frac_pcs}{Numeric in (0, 1]. If \code{n_pcs} is \code{NULL}, the
default number of PCs is computed as \code{max(10, round(max_frac_pcs * N))},
where \code{N} is the number of samples.}

\item{n_pcs}{Integer or \code{NULL}. Explicit number of NAM PCs to compute
(and also used to build neighbors in the internally constructed Seurat
object). If \code{NULL}, uses \code{max_frac_pcs} heuristic.}

\item{ks}{Optional integer vector. Candidate numbers of NAM PCs to scan in the
min-p procedure. If \code{NULL}, a default grid is constructed from sample
size and available PCs.}

\item{Nnull}{Integer. Number of conditional permutation replicates.}

\item{force_permute_all}{Logical. If \code{TRUE}, ignores \code{batches} and
permutes all samples together.}

\item{seed}{Integer or \code{NULL}. Random seed used for permutations. If
\code{NULL}, a random seed is chosen.}

\item{return_nam}{Logical. If \code{TRUE}, stores NAM-related matrices
(embeddings/loadings/variance explained and NAM itself) into the returned
object.}
}
\value{
A \code{\linkS4class{scLASER}} object with updated slots:
\itemize{
  \item \code{@nam_pcs}: NAM neighborhood-by-PC matrix.
  \item \code{@NAM_matrix}: NAM sample-by-neighborhood matrix (transposed as stored).
}
(Additional association results may be stored in the Seurat reduction
internally, depending on implementation.)
}
\description{
Computes Neighborhood Aggregation Matrix (NAM) embeddings from a Seurat
nearest-neighbor graph, residualizes NAM with respect to optional covariates,
performs SVD to obtain NAM PCs, and tests association between the NAM subspace
and a numeric sample-level variable using a min-p scan over candidate numbers
of PCs with conditional permutations.
}
\details{
This function can either (A) use a provided \pkg{Seurat} object that already
contains a neighbor graph, or (B) construct a minimal Seurat object internally
from \code{obj@metadata} and \code{obj@harmony} and then build the graph.
}
\examples{
\donttest{
## Example workflow (requires PCs + Harmony already computed in the scLASER object)
## 1) Load a prepared scLASER object that already contains metadata and PCs.
##    (You typically create this in your own pipeline and save it as an .rds.)
# obj <- readRDS("path/to/precomputed_scLASER_object.rds")

## 2) (Optional) If Harmony embeddings are not present, compute them.
##    This assumes obj@pcs is populated and obj@metadata contains `sample_id`
##    (or another batch column).
# obj <- run_harmony(obj, batch_col = "sample_id")

## 3) Run association testing.
##    If you do not pass a Seurat object, this function will internally
##    construct a minimal Seurat object from obj@metadata + obj@harmony.
# obj <- association_nam_scLASER(
#   obj          = obj,
#   seurat_object = NULL,
#   test_var     = "age",
#   samplem_key  = "sample_id",
#   batches      = c("sample_id"),
#   covs         = c("sex"),
#   Nnull        = 200,
#   seed         = 1
# )

## 4) Inspect outputs
# dim(obj@nam_pcs)
# dim(obj@NAM_matrix)
}
}
\seealso{
\code{\link[Seurat]{FindNeighbors}},
  \code{\link[Seurat]{CreateSeuratObject}},
  \code{\link[Seurat]{CreateDimReducObject}}
}
